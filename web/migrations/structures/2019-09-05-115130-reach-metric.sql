CREATE TABLE calendar (id CHAR(36) NOT NULL COMMENT '(DC2Type:guid)', campaign_id INT DEFAULT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, INDEX IDX_6EA9A146F639F774 (campaign_id), INDEX IDX_6EA9A146B03A8386 (created_by_id), INDEX IDX_6EA9A146896DBBDE (updated_by_id), INDEX IDX_6EA9A146C76F1F52 (deleted_by_id), UNIQUE INDEX campaign_idx (id, campaign_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE metric_statistic (id INT AUTO_INCREMENT NOT NULL, metric_id INT DEFAULT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, block_time TIME NOT NULL, block_day SMALLINT NOT NULL, t600 SMALLINT DEFAULT NULL, t700 SMALLINT DEFAULT NULL, t800 SMALLINT DEFAULT NULL, value SMALLINT DEFAULT NULL, inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, INDEX IDX_3222A325A952D583 (metric_id), INDEX IDX_3222A325B03A8386 (created_by_id), INDEX IDX_3222A325896DBBDE (updated_by_id), INDEX IDX_3222A325C76F1F52 (deleted_by_id), INDEX block_day_time_idx (block_time, block_day), UNIQUE INDEX metric_block_idx (metric_id, block_day, block_time), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
ALTER TABLE calendar ADD CONSTRAINT FK_6EA9A146F639F774 FOREIGN KEY (campaign_id) REFERENCES campaign (id) ON DELETE CASCADE;
ALTER TABLE calendar ADD CONSTRAINT FK_6EA9A146B03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE calendar ADD CONSTRAINT FK_6EA9A146896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE calendar ADD CONSTRAINT FK_6EA9A146C76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE metric_statistic ADD CONSTRAINT FK_3222A325A952D583 FOREIGN KEY (metric_id) REFERENCES metric (id) ON DELETE CASCADE;
ALTER TABLE metric_statistic ADD CONSTRAINT FK_3222A325B03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE metric_statistic ADD CONSTRAINT FK_3222A325896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE metric_statistic ADD CONSTRAINT FK_3222A325C76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE shop ADD users_group_id INT DEFAULT NULL;
ALTER TABLE shop ADD CONSTRAINT FK_AC6A4CA28515F29D FOREIGN KEY (users_group_id) REFERENCES users_group (id) ON DELETE CASCADE;
CREATE INDEX IDX_AC6A4CA28515F29D ON shop (users_group_id);
ALTER TABLE metric ADD created_by_id INT DEFAULT NULL, ADD updated_by_id INT DEFAULT NULL, ADD deleted_by_id INT DEFAULT NULL, DROP block_time, DROP block_day_of_week, CHANGE value name VARCHAR(255) NOT NULL;
ALTER TABLE metric ADD CONSTRAINT FK_87D62EE3B03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE metric ADD CONSTRAINT FK_87D62EE3896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE metric ADD CONSTRAINT FK_87D62EE3C76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
CREATE INDEX IDX_87D62EE3B03A8386 ON metric (created_by_id);
CREATE INDEX IDX_87D62EE3896DBBDE ON metric (updated_by_id);
CREATE INDEX IDX_87D62EE3C76F1F52 ON metric (deleted_by_id);
CREATE UNIQUE INDEX identify_idx ON metric (shop_id, target_group_id, metric_param_id);
