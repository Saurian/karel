CREATE TABLE users (id INT AUTO_INCREMENT NOT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, first_name VARCHAR(64) NOT NULL, last_name VARCHAR(64) NOT NULL, mail VARCHAR(128) NOT NULL, username VARCHAR(128) NOT NULL, password VARCHAR(32) NOT NULL, new_password VARCHAR(32) DEFAULT NULL, active TINYINT(1) NOT NULL, role VARCHAR(32) NOT NULL, inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, position INT NOT NULL, category VARCHAR(128) NOT NULL, INDEX IDX_1483A5E9B03A8386 (created_by_id), INDEX IDX_1483A5E9896DBBDE (updated_by_id), INDEX IDX_1483A5E9C76F1F52 (deleted_by_id), INDEX first_last_name_idx (first_name, last_name), INDEX position_idx (position), INDEX user_active_idx (active), INDEX role_idx (role), INDEX mail_idx (mail), INDEX password_idx (password), UNIQUE INDEX username_mail_idx (username, mail), UNIQUE INDEX username_idx (username), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE users_devices (user_entity_id INT NOT NULL, device_entity_id INT NOT NULL, INDEX IDX_E1073A5081C5F0B9 (user_entity_id), INDEX IDX_E1073A50BAC569CC (device_entity_id), PRIMARY KEY(user_entity_id, device_entity_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE users_devices_groups (user_entity_id INT NOT NULL, device_group_entity_id INT NOT NULL, INDEX IDX_5389E9C281C5F0B9 (user_entity_id), INDEX IDX_5389E9C2FC8D9E51 (device_group_entity_id), PRIMARY KEY(user_entity_id, device_group_entity_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE device (id INT AUTO_INCREMENT NOT NULL, default_campaign_id INT DEFAULT NULL, loop_campaign_id INT DEFAULT NULL, device_group_id INT DEFAULT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, sn VARCHAR(128) NOT NULL, psw VARCHAR(32) DEFAULT NULL, name VARCHAR(255) NOT NULL, street VARCHAR(255) NOT NULL, strno VARCHAR(255) DEFAULT NULL, zip VARCHAR(255) NOT NULL, city VARCHAR(255) NOT NULL, active TINYINT(1) DEFAULT '0' NOT NULL, keywords MEDIUMTEXT DEFAULT NULL COMMENT 'fullSearch keyword', inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, position INT NOT NULL, category VARCHAR(128) NOT NULL, version INT DEFAULT 1 NOT NULL, UNIQUE INDEX UNIQ_92FB68EEFC17495 (sn), INDEX IDX_92FB68E22CAE4C2 (default_campaign_id), INDEX IDX_92FB68ED78257DA (loop_campaign_id), INDEX IDX_92FB68E70608067 (device_group_id), INDEX IDX_92FB68EB03A8386 (created_by_id), INDEX IDX_92FB68E896DBBDE (updated_by_id), INDEX IDX_92FB68EC76F1F52 (deleted_by_id), INDEX device_active_idx (active), INDEX device_name_idx (name), INDEX position_idx (position), FULLTEXT INDEX keywords_idx (keywords), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE device_group (id INT AUTO_INCREMENT NOT NULL, root_id INT DEFAULT NULL, parent_id INT DEFAULT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, name VARCHAR(255) NOT NULL, active TINYINT(1) DEFAULT '0' NOT NULL, un_place TINYINT(1) DEFAULT '0' NOT NULL, inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, position INT NOT NULL, category VARCHAR(128) NOT NULL, lft INT NOT NULL, lvl INT NOT NULL, rgt INT NOT NULL, INDEX IDX_AB45A4A279066886 (root_id), INDEX IDX_AB45A4A2727ACA70 (parent_id), INDEX IDX_AB45A4A2B03A8386 (created_by_id), INDEX IDX_AB45A4A2896DBBDE (updated_by_id), INDEX IDX_AB45A4A2C76F1F52 (deleted_by_id), INDEX active_idx (active), INDEX position_idx (position), INDEX name_idx (name), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE devices_groups (device_group_entity_id INT NOT NULL, device_entity_id INT NOT NULL, INDEX IDX_2D317077FC8D9E51 (device_group_entity_id), INDEX IDX_2D317077BAC569CC (device_entity_id), PRIMARY KEY(device_group_entity_id, device_entity_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE template (id INT AUTO_INCREMENT NOT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, name VARCHAR(255) NOT NULL, inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, INDEX IDX_97601F83B03A8386 (created_by_id), INDEX IDX_97601F83896DBBDE (updated_by_id), INDEX IDX_97601F83C76F1F52 (deleted_by_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE templates_users (template_entity_id INT NOT NULL, user_entity_id INT NOT NULL, INDEX IDX_9D4E136F48760BEB (template_entity_id), INDEX IDX_9D4E136F81C5F0B9 (user_entity_id), PRIMARY KEY(template_entity_id, user_entity_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE medium_data (id INT AUTO_INCREMENT NOT NULL, medium_id INT DEFAULT NULL, campaign_id INT DEFAULT NULL, time SMALLINT DEFAULT NULL, time_type VARCHAR(10) DEFAULT NULL, identifier VARCHAR(255) DEFAULT NULL, file_name VARCHAR(255) DEFAULT NULL, file_path VARCHAR(255) DEFAULT NULL, sound TINYINT(1) DEFAULT NULL, url VARCHAR(255) DEFAULT NULL, type VARCHAR(32) DEFAULT NULL, keywords MEDIUMTEXT DEFAULT NULL COMMENT 'fullSearch keyword', position INT NOT NULL, category VARCHAR(128) NOT NULL, INDEX IDX_35EC59B2E252B6A5 (medium_id), INDEX IDX_35EC59B2F639F774 (campaign_id), FULLTEXT INDEX keywords_idx (keywords), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE log (id INT AUTO_INCREMENT NOT NULL, user_id INT DEFAULT NULL, role VARCHAR(255) DEFAULT NULL, target VARCHAR(255) DEFAULT NULL, target_key INT DEFAULT NULL, type VARCHAR(255) DEFAULT NULL, action VARCHAR(255) DEFAULT NULL, message LONGTEXT NOT NULL, context LONGTEXT NOT NULL COMMENT '(DC2Type:json_array)', level SMALLINT NOT NULL, level_name VARCHAR(50) NOT NULL, extra LONGTEXT NOT NULL COMMENT '(DC2Type:json_array)', inserted DATETIME NOT NULL, INDEX IDX_8F3F68C5A76ED395 (user_id), INDEX created_idx (inserted), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE medium (id INT AUTO_INCREMENT NOT NULL, template_id INT DEFAULT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, type VARCHAR(255) NOT NULL, inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, INDEX IDX_C67345B75DA0FB8 (template_id), INDEX IDX_C67345B7B03A8386 (created_by_id), INDEX IDX_C67345B7896DBBDE (updated_by_id), INDEX IDX_C67345B7C76F1F52 (deleted_by_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE device_log (id INT AUTO_INCREMENT NOT NULL, device_id INT DEFAULT NULL, ssid VARCHAR(32) NOT NULL, command VARCHAR(64) NOT NULL, valid TINYINT(1) NOT NULL, params LONGTEXT DEFAULT NULL COMMENT '(DC2Type:json_array)', result LONGTEXT DEFAULT NULL COMMENT '(DC2Type:json_array)', reason VARCHAR(255) DEFAULT NULL, inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, INDEX IDX_65C1B25C94A4C7D4 (device_id), INDEX ssid_idx (ssid), INDEX command_idx (command), INDEX reason_idx (reason), INDEX valid_idx (valid), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE campaign (id INT AUTO_INCREMENT NOT NULL, template_id INT DEFAULT NULL, created_by_id INT DEFAULT NULL, updated_by_id INT DEFAULT NULL, deleted_by_id INT DEFAULT NULL, name VARCHAR(255) NOT NULL, realized_from DATETIME NOT NULL COMMENT 'plán od', realized_to DATETIME NOT NULL COMMENT 'plán do', active TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'aktivní', tag VARCHAR(32) DEFAULT NULL COMMENT 'štítek', keywords MEDIUMTEXT DEFAULT NULL COMMENT 'fullSearch keyword', inserted DATETIME DEFAULT NULL, updated DATETIME DEFAULT NULL, position INT NOT NULL, category VARCHAR(128) NOT NULL, version INT DEFAULT 1 NOT NULL, INDEX IDX_1F1512DD5DA0FB8 (template_id), INDEX IDX_1F1512DDB03A8386 (created_by_id), INDEX IDX_1F1512DD896DBBDE (updated_by_id), INDEX IDX_1F1512DDC76F1F52 (deleted_by_id), INDEX from_to_idx (realized_from, realized_to), INDEX campaign_active_idx (active), INDEX tag_idx (tag), FULLTEXT INDEX name_idx (name), FULLTEXT INDEX keywords_idx (keywords), FULLTEXT INDEX keywords_name_idx (name, keywords), INDEX position_idx (position), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE campaigns_devices (campaign_entity_id INT NOT NULL, device_entity_id INT NOT NULL, INDEX IDX_33FA082F41AD6126 (campaign_entity_id), INDEX IDX_33FA082FBAC569CC (device_entity_id), PRIMARY KEY(campaign_entity_id, device_entity_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE campaigns_devices_groups (campaign_entity_id INT NOT NULL, device_group_entity_id INT NOT NULL, INDEX IDX_3CE20A5841AD6126 (campaign_entity_id), INDEX IDX_3CE20A58FC8D9E51 (device_group_entity_id), PRIMARY KEY(campaign_entity_id, device_group_entity_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE identity (id INT AUTO_INCREMENT NOT NULL, email VARCHAR(127) NOT NULL, password_hash VARCHAR(127) NOT NULL, name VARCHAR(127) NOT NULL, roles LONGTEXT DEFAULT NULL COMMENT '(DC2Type:simple_array)', UNIQUE INDEX UNIQ_6A95E9C4E7927C74 (email), UNIQUE INDEX UNIQ_6A95E9C45E237E06 (name), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
ALTER TABLE users ADD CONSTRAINT FK_1483A5E9B03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE users ADD CONSTRAINT FK_1483A5E9896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE users ADD CONSTRAINT FK_1483A5E9C76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE users_devices ADD CONSTRAINT FK_E1073A5081C5F0B9 FOREIGN KEY (user_entity_id) REFERENCES users (id) ON DELETE CASCADE;
ALTER TABLE users_devices ADD CONSTRAINT FK_E1073A50BAC569CC FOREIGN KEY (device_entity_id) REFERENCES device (id) ON DELETE CASCADE;
ALTER TABLE users_devices_groups ADD CONSTRAINT FK_5389E9C281C5F0B9 FOREIGN KEY (user_entity_id) REFERENCES users (id) ON DELETE CASCADE;
ALTER TABLE users_devices_groups ADD CONSTRAINT FK_5389E9C2FC8D9E51 FOREIGN KEY (device_group_entity_id) REFERENCES device_group (id) ON DELETE CASCADE;
ALTER TABLE device ADD CONSTRAINT FK_92FB68E22CAE4C2 FOREIGN KEY (default_campaign_id) REFERENCES campaign (id) ON DELETE CASCADE;
ALTER TABLE device ADD CONSTRAINT FK_92FB68ED78257DA FOREIGN KEY (loop_campaign_id) REFERENCES campaign (id) ON DELETE CASCADE;
ALTER TABLE device ADD CONSTRAINT FK_92FB68E70608067 FOREIGN KEY (device_group_id) REFERENCES device_group (id) ON DELETE CASCADE;
ALTER TABLE device ADD CONSTRAINT FK_92FB68EB03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE device ADD CONSTRAINT FK_92FB68E896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE device ADD CONSTRAINT FK_92FB68EC76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE device_group ADD CONSTRAINT FK_AB45A4A279066886 FOREIGN KEY (root_id) REFERENCES device_group (id) ON DELETE CASCADE;
ALTER TABLE device_group ADD CONSTRAINT FK_AB45A4A2727ACA70 FOREIGN KEY (parent_id) REFERENCES device_group (id) ON DELETE CASCADE;
ALTER TABLE device_group ADD CONSTRAINT FK_AB45A4A2B03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE device_group ADD CONSTRAINT FK_AB45A4A2896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE device_group ADD CONSTRAINT FK_AB45A4A2C76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE devices_groups ADD CONSTRAINT FK_2D317077FC8D9E51 FOREIGN KEY (device_group_entity_id) REFERENCES device_group (id) ON DELETE CASCADE;
ALTER TABLE devices_groups ADD CONSTRAINT FK_2D317077BAC569CC FOREIGN KEY (device_entity_id) REFERENCES device (id) ON DELETE CASCADE;
ALTER TABLE template ADD CONSTRAINT FK_97601F83B03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE template ADD CONSTRAINT FK_97601F83896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE template ADD CONSTRAINT FK_97601F83C76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE templates_users ADD CONSTRAINT FK_9D4E136F48760BEB FOREIGN KEY (template_entity_id) REFERENCES template (id) ON DELETE CASCADE;
ALTER TABLE templates_users ADD CONSTRAINT FK_9D4E136F81C5F0B9 FOREIGN KEY (user_entity_id) REFERENCES users (id) ON DELETE CASCADE;
ALTER TABLE medium_data ADD CONSTRAINT FK_35EC59B2E252B6A5 FOREIGN KEY (medium_id) REFERENCES medium (id) ON DELETE SET NULL;
ALTER TABLE medium_data ADD CONSTRAINT FK_35EC59B2F639F774 FOREIGN KEY (campaign_id) REFERENCES campaign (id) ON DELETE CASCADE;
ALTER TABLE log ADD CONSTRAINT FK_8F3F68C5A76ED395 FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE;
ALTER TABLE medium ADD CONSTRAINT FK_C67345B75DA0FB8 FOREIGN KEY (template_id) REFERENCES template (id) ON DELETE CASCADE;
ALTER TABLE medium ADD CONSTRAINT FK_C67345B7B03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE medium ADD CONSTRAINT FK_C67345B7896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE medium ADD CONSTRAINT FK_C67345B7C76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE device_log ADD CONSTRAINT FK_65C1B25C94A4C7D4 FOREIGN KEY (device_id) REFERENCES device (id) ON DELETE CASCADE;
ALTER TABLE campaign ADD CONSTRAINT FK_1F1512DD5DA0FB8 FOREIGN KEY (template_id) REFERENCES template (id) ON DELETE CASCADE;
ALTER TABLE campaign ADD CONSTRAINT FK_1F1512DDB03A8386 FOREIGN KEY (created_by_id) REFERENCES users (id);
ALTER TABLE campaign ADD CONSTRAINT FK_1F1512DD896DBBDE FOREIGN KEY (updated_by_id) REFERENCES users (id);
ALTER TABLE campaign ADD CONSTRAINT FK_1F1512DDC76F1F52 FOREIGN KEY (deleted_by_id) REFERENCES users (id);
ALTER TABLE campaigns_devices ADD CONSTRAINT FK_33FA082F41AD6126 FOREIGN KEY (campaign_entity_id) REFERENCES campaign (id) ON DELETE CASCADE;
ALTER TABLE campaigns_devices ADD CONSTRAINT FK_33FA082FBAC569CC FOREIGN KEY (device_entity_id) REFERENCES device (id) ON DELETE CASCADE;
ALTER TABLE campaigns_devices_groups ADD CONSTRAINT FK_3CE20A5841AD6126 FOREIGN KEY (campaign_entity_id) REFERENCES campaign (id) ON DELETE CASCADE;
ALTER TABLE campaigns_devices_groups ADD CONSTRAINT FK_3CE20A58FC8D9E51 FOREIGN KEY (device_group_entity_id) REFERENCES device_group (id) ON DELETE CASCADE;
